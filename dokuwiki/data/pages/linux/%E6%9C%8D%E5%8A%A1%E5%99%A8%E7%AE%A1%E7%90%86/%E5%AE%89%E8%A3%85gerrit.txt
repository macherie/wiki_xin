======安装gerrit======

===1. 安装mysql===
<code>
sudo apt-get install mysql-server
</code>
===2. 需要创建一个专用账户用来管理gerrit相关的信息===

创建用户gerrit2：
<code>
sudo useradd -m gerrit2
</code>

为gerrit2设置密码：
<code>
sudo passwd gerrit2
</code>
把gerrit2账户添加到git组里以便gerrit能够读取版本库内容。
<code>
sudo adduser gerrit2 git
</code>

===3. 换到gerrit2用户下：su gerrit2，然后使用命令cp –a /tmp/gerrit-2.2.1.war gerrit.war将之前下载的gerrit-2.2.1.war拷贝到/home/gerrit2目录下。===

===4. 创建mysql用户：先使用命令进入mysql的控制台：mysql -u root -p，并输入root用户的密码（root的密码在安装mysql时设置的），进入mysql控制台。执行以下命令创建一个与数据库关联的web应用的用户，并给这个用户设置密码，创建一个数据库，并使新建的用户对数据库具有最高权限。===
<code>
CREATE USER 'gerrit2'@'localhost' IDENTIFIED BY '123';
CREATE DATABASE reviewdb;
ALTER DATABASE reviewdb charset=utf8;
GRANT ALL ON reviewdb.* TO 'gerrit2'@'localhost';
FLUSH PRIVILEGES;                               ----------刷新数据库
</code>

===5. 安装gerrit：新建了mysql的用户后，退出mysql控制台（exit命令即可）。然后执行命令java -jar gerrit.war init -d review_site安装和配置gerrit。之后会问一些配置，还要求输入数据库的密码。在实际操作中，有如下几条需要特别说明，其他默认即可（直接回车）：===
<code>
Create '/home/gerrit2/review_site' [Y/n]? y       ---------------创建review_site文件夹
Location of Git repositories   [git]: 
Database server type           [H2/?]: mysql  ---------------数据库的类型选择mysql
Gerrit Code Review is not shipped with MySQL Connector/J 5.1.10
**  This library is required for your configuration. **
Download and install it now [Y/n]? y           ---------下载并安装与mysql相关的lib库
Use mysql-connector-java-5.1.10.jar anyway [y/n]? y
Server hostname                [localhost]: 
Server port                    [(MYSQL default)]:
Database name                  [reviewdb]:  ----数据库的名字为reviewdb，直接回车
Database username              [gerrit2]:     ----数据库的用户为gerrit2，直接回车
gerrit2's password             :              -----输入gerrit2的密码。此处gerrit2的密码要与ubuntu系统的密码区分开，此处输入的密码应该是在数据库中gerrit2用户的密码(123)
Authentication method          [OPENID/?]: ldap -----------选择用户认证方式
LDAP server                    [ldap://localhost]: ldap://simcom-sh.com
LDAP username                  : gitserver
gitserver's password           : sim123_2015
              confirm password : sim123_2015
Account BaseDN                 [DC=com]: ou=gerrit server,DC=simcom-sh,DC=com
Group BaseDN                   [ou=gerrit server,DC=simcom-sh,DC=com]: CN=gerrit,ou=gerrit server,DC=simcom-sh,DC=com
SMTP server hostname           [localhost]: mail.sim.com
SMTP server port               [(default)]: 
SMTP encryption                [NONE/?]: 
SMTP username                  [gerrit2]: gitserver
gitserver's password           : sim123_2015
              confirm password : sim123_2015
Run as                         [gerrit2]: 
Java runtime                   [/usr/lib/jvm/jdk1.6.0_34/jre]: 
Copy gerrit.war to /home/gerrit2/review_site/bin/gerrit.war [Y/n]? y  -----拷贝
Gerrit Code Review is not shipped with Bouncy Castle Crypto v144
  If available, Gerrit can take advantage of features
  in the library, but will also function without it.
Download and install it now [Y/n]? y          ------------下载和安装与gerrit相关的lib库
Behind reverse proxy           [y/N]? 
Use SSL (https://)             [y/N]? 
Listen on address              [*]: 
Listen on port                 [8080]:
</code>

===6. 修改配置文件===
<code>
vim review_site/etc/gerrit.config
</code>

在最后加入如下几行：
<code>
[repo]
        showDownloadCommand = true
[gitweb]
        cgi = /usr/share/gitweb/gitweb.cgi
</code>

===7. 设置开机自动启动===
<code>
sudo ln -snf /home/gerrit2/review_site/bin/gerrit.sh /etc/init.d/gerrit.sh
sudo ln -snf /etc/init.d/gerrit.sh /etc/rc2.d/S90gerrit
sudo ln -snf /etc/init.d/gerrit.sh /etc/rc3.d/S90gerrit
</code>

服务自动启动脚本/etc/init.d/gerrit.sh需要通过/etc/default/gerritcodereview提供一些默认的配置。以下面的内容来创建该文件。
<code>
GERRIT_SITE=/home/gerrit2/review_site
NO_START=0
</code>