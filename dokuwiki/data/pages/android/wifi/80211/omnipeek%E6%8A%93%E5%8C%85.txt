====== Simple OmniPeek Guide ======

OmniPeek is a famous WiFi network analysis tool. We often use this tool to trouble shooting Wifi issues.

This simple guide will let you know how to use OmniPeek to capture WiFi packets. We assume you have installed the OmniPeek software.

===== Select a WiFi card, and install its driver =====
Please check this link to find out the supported wireless adapter list.
After the wireless adapter has been plugged into your PC and driver is correctly installed, you will see the device in device manager.

We use D-Link DWA-140 USB WiFi adapter as example in this document. 

{{:android:wifi:80211:1.png|}}
===== Start capture =====
Let's start capture WiFi packets over air now.

Run OmniPeek, click File -> New Capture
We suggest you to check the Continuous capture checkbox
We also suggest you to check the Capture to disk checkbox if you need to run a long time capturing.

{{:android:wifi:80211:2.png|}}

Select the correct Adapter, you will see the adapter information in the down-right window.

{{:android:wifi:80211:3.png|}}

Now select channel. If you selected wrong adapter, you will not be able to select channel.

{{:android:wifi:80211:4.png|}}

Okay, go! You can Start/Stop Capture by clicking the top-right large button.
You can click the Auto Scrool icon to always check the fresh packets.

{{:android:wifi:80211:5.png|}}


===== Packet Analysis =====
Now you have your WiFi sniffer files in your hand. We have some tips can make you feel easier to check them.

Please be familiar with these packet flags.
For example, C means CRC error, + means retransmission.

{{:android:wifi:80211:1.png|{{:android:wifi:80211:6.png|}}}}

Check the left panel, and go to Wireless -> WLAN. We can see the packets are grouped by AP-STAs.

{{:android:wifi:80211:7.png|}}

 Select one AP or STA, and do right click, we can select packets by source and destination.

{{:android:wifi:80211:8.png|}}

 You can copy the selected packets to new window.

{{:android:wifi:80211:9.png|}}

We can also go to Statistics -> Protocols, and select packets by protocol. 

{{:android:wifi:80211:10.png|}}



===== Decrypt WEP packets =====

In many cases, the AP is set to WEP mode, it will be very convenient if we can decrypt the WEP packets.
Of course, OmniPeek supports this feature.

Select Tools -> Decrypt WLAN Packets to decrypt WEP packets.

{{:android:wifi:80211:11.png|}}

If the WEP key set is not defined yet, we can edit WEP key set by clicking the ... button, and then select Insert...

{{:android:wifi:80211:12.png|}}


===== Decrypt WPA packets =====

Now in most cases, AP is set to WPA mode. And OmniPeek also supports decrypt WPA packets. It's a little bit more complex than WEP mode.

Let's read this part from OmniPeek help file.

{{:android:wifi:80211:13.png|}}

Here's an example. We captured some WPA packets here.
Please note it's encrypted by CCMP.

{{:android:wifi:80211:14.png|}}

Now we use Tools -> Decrypt WLAN Packets to decrypt all packets.
With correct WPA passphrase and SSID setting.

{{:android:wifi:80211:15.png|}}

 And now we can see the CCMP packets are successfully decrypted.

{{:android:wifi:80211:16.png|}}

So the key point is to capture all 4 hand shaking packets.
===== Tips =====

DO NOT set any filter when you capture the WiFi packets.


