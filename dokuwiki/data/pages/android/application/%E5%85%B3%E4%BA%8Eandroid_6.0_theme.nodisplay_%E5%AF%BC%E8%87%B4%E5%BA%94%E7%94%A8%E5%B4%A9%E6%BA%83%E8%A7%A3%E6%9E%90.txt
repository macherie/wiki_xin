**关于android 6.0+ Theme.NoDisplay_导致应用崩溃解析**

**1. 现象**
   将S700（Android 5.0）上的OSUpdate（project_dir/vendor/qcom/proprietary/qrdplus/OSUpdate）移植到PSB01（Android6.0）之后编译相应的版本并烧到设备中去
   使用OSUpdate执行OTA升级，选择相应的ota升级包之后程序崩溃并抛出：java.lang.IllegalStateException: Activity {com.qualcomm.update/com.qualcomm.update.InstallReceiver} did not call finish() prior to onResume() completing错误信息

{{ :playgrond:error.png?1000x700 |}}

**2. 原因**
   此崩溃只会在Android6.0+（targetSdkVersion is 23 or higher）中才会出现，在下属第一个链接中，将此问题归于Android M的一个BUG。
   主要操作是因为在开发应用程序过程中将其中一个Activity或者多个Activity使用了“Theme.NoDisplay”这个主题。当我们在Activity的OnCreate函数中所做的操作过多，
   比如启动一个服务，然后调用finish()结束当前Activity或者调用startActivityForResult()并在onActivityResult()中调用finish()时都由可能出现
   IllegalStateException。下属第二篇文章中有以下一段话：
      “The issue that was filed on the M Developer Preview about this ran into the problem when trying to show a Dialog from onCreate(). The issue went nowhere.”
    在我们OSUpdate中就是因为为InstallReceiver这个Activity设置了NoDisplay主题并且在onCreate中要求显示一个dialog让用户选择是否需要升级才导致应用崩溃；
   
   以下附上文章链接：
  （1）. 本链接文章是stackoverflow对问题的一些描述，原因及解决办法：http://stackoverflow.com/questions/32169303/activity-did-not-call-finish-api-23
  （2）. 本文文章是对造成崩溃的原因，导致崩溃的操作，场合以及解决办法做了详细的说明 ，wiki目录地址 ： 
                        开始 » android » application  » android_6.0_theme.nodisplay_regression 
         （PS：原始链接打开速度比较坑，所以将原文章内容单独做成了wiki以供查阅，另外文章中描述的崩溃代码操作在OSUpdate源码中都有出现，参考价值较大）。
  
  
  
**解决方法**
   前两篇链接文章中都有提及，在此不再赘述。
  