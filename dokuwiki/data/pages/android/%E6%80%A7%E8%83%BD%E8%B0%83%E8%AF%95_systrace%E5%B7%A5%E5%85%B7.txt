=====性能调试 Performance tuning=====


====systrace工具====
<code>
位置:
external/chromium-trace/systrace.py
</code>


保存下面的代码到ztrace.sh, 在抓取之前先执行下面指令 source ztrace.sh
<code>
adb shell setprop service.adb.root 1
adb wait-for-device
adb shell setenforce 0
adb wait-for-device

adb root
adb wait-for-device
adb remount
adb shell "echo 0 > /sys/kernel/debug/tracing/tracing_on"
adb shell "echo > /sys/kernel/debug/tracing/trace"
adb shell "echo 51200 > /sys/kernel/debug/tracing/buffer_size_kb"
adb shell "echo thermal:* > /sys/kernel/debug/tracing/set_event"
adb shell "echo msm_low_power:* >> /sys/kernel/debug/tracing/set_event"
adb shell "echo sched:sched_migrate_task >> /sys/kernel/debug/tracing/set_event"
adb shell "echo sched:sched_switch >> /sys/kernel/debug/tracing/set_event"
adb shell "echo sched:sched_wakeup >> /sys/kernel/debug/tracing/set_event"
adb shell "echo sched:sched_cpu_load >> /sys/kernel/debug/tracing/set_event"
adb shell "echo core_ctl_eval_need >> /sys/kernel/debug/tracing/set_event"
adb shell "echo cpufreq_interactive:* >> /d/tracing/set_event"
adb shell "echo kgsl:* >> /d/tracing/set_event"
adb shell "echo mdss:* >> /d/tracing/set_event"
adb shell "echo irq:* >> /sys/kernel/debug/tracing/set_event"
adb shell "cat /sys/kernel/debug/tracing/set_event"
</code>

====抓取方法:====
1. Frame drop issue on browsing, gaming, and UX 丢帧问题，浏览，游戏，和UX
<code>
$ python systrace.py gfx input view sched am wm dalvik freq idle load sync workq power mmc disk -b 40000 -t 10 -o output.html
</code>

2. Application launch latency 应用程序启动延迟
<code>
$ python systrace.py gfx input sched am wm dalvik freq idle load sync workq power mmc disk  -b 40000 -t 10 -o output.html
</code>

3. Audio quality issue 音频质量问题
<code>
$ python systrace.py sched dalvik freq idle load sync workq power mmc disk audio hal res -b 40000 -t 10 -o output.html
</code>

4. Camera frame drop issue 相机帧下降问题
<code>
$ python systrace.py gfx sched am wm dalvik freq idle load sync workq power mmc disk camera hal res membus -b 40000 -t 10 -o output.html
</code>

5. Video frame drop issue 视频帧下降问题
<code>
$ python systrace.py gfx sched am wm dalvik freq idle load sync workq power mmc disk video audio hal res membus –b 40000 –t 10 -o output.htm
</code>

====相关文档：====
MSM8939/MSM8952/MSM8909性能调试文档\\ 
80-P0584-1_COMMON PERFORMANCE ISSUES DEBUGGING GUIDE

