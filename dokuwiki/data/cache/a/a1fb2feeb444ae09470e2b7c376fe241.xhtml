
<h1 class="sectionedit1" id="android添加pppoe拨号功能">Android添加pppoe拨号功能</h1>
<div class="level1">

<p>
在android下有自带拨号用的pppd,位于/system/bin下，另外还需要移植pppoe.
</p>

</div>
<!-- EDIT1 SECTION "Android添加pppoe拨号功能" [1-134] -->
<h2 class="sectionedit2" id="pppoe的移植">1.pppoe的移植</h2>
<div class="level2">

<p>
用开源的rp-pppoe来编译生成pppoe client端执行程序。
附件是rp-pppoe-3.10代码。<a href="/dokuwiki/lib/exe/fetch.php/android;rp-pppoe-3.10.tar.gz" class="media mediafile mf_gz" title="android:rp-pppoe-3.10.tar.gz (210.2 KB)">rp-pppoe-3.10.tar.gz</a>
</p>

<p>
把代码解压放在extern/下面，编写Android.mk，见附件：<a href="/dokuwiki/lib/exe/fetch.php/android;android_mk.doc" class="media mediafile mf_doc" title="android:android_mk.doc (481 B)">android_mk.doc</a>
编译后生成system/xbin/pppoe，push到机器内，adb push pppoe /system/xbin/pppoe
</p>

</div>
<!-- EDIT2 SECTION "1.pppoe的移植" [135-482] -->
<h2 class="sectionedit3" id="kernel侧添加pppoe支持">2.kernel侧添加pppoe支持</h2>
<div class="level2">

<p>
CONFIG_PPP=y
</p>

<p>
CONFIG_PPP_ASYNC=y
</p>

<p>
CONFIG_PPP_SYNC_TTY=y
</p>

<p>
CONFIG_PPP_DEFLATE=y
</p>

<p>
CONFIG_PPP_BSDCOMP=y
</p>

<p>
CONFIG_PPPOE=y
</p>

<p>
CONFIG_N_HDLC=y
</p>

<p>
CONFIG_UNIX98_PTYS=y
</p>

<p>
编译生成boot.img，烧录进机器。
</p>

</div>
<!-- EDIT3 SECTION "2.kernel侧添加pppoe支持" [483-722] -->
<h2 class="sectionedit4" id="拨号验证">3.拨号验证</h2>
<div class="level2">

<p>
测试环境：由于s200没有RJ45接口，我家里的测试环境如下：
1.家里网口端用网线接我的无线路由器的LAN口，注意是LAN口，不是WAN口！这样的目的是想让s200和无线路由器以及pppoe server端在一个局域网环境，使得pppoe server端可以接收pppoe拨号时的包。
2.s200连接无线路由器。
</p>

<p>
测试命令：
#adb shell
#/system/bin/pppd pty “/system/xbin/pppoe -p /etc/ppp/pid.pppoe -I wlan0 -T 80 -U -m 1412 -D /system/pppoe112.txt” noipdefault noauth default-asyncmap nodefaultroute hide-password nodetach usepeerdns mtu 1492 mru 1492 noaccomp nodeflate nopcomp novj novjccomp user slB207 password slB207
</p>

<p>
注意上面的两个slB207就是拨号用的用户名和密码。
调用上面的命令后，如果拨号成功，可以通过netcfg看到ppp0已经UP等相关信息。
#netcfg
PPP0 UP xxxxxx XXX
</p>

<p>
此时尝试ping百度的ip
#ping 202.108.22.5
发现ping不通
</p>

<p>
调用下面命令添加路由
#route add -net 0.0.0.0 netmask 0.0.0.0 dev ppp0
再ping发现可以ping通了。
</p>

<p>
#ping <a href="http://www.baidu.com" class="urlextern" title="http://www.baidu.com"  rel="nofollow">www.baidu.com</a>
发现不通，肯定dns有问题
</p>

<p>
设置dns
#setprop net.dns1 10.127.127.1
再ping，可以ping通
#ping <a href="http://www.baidu.com" class="urlextern" title="http://www.baidu.com"  rel="nofollow">www.baidu.com</a>
</p>

<p>
结束。
</p>

</div>
<!-- EDIT4 SECTION "3.拨号验证" [723-] -->