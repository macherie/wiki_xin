
<p>
<strong>1 检查kernel中的deconfig</strong>
</p>
<pre class="code">将deconfig中以上这些文件去掉，这些主要用于debug和log，对系统性能有一定的影响。
CONFIG_PREEMPT_COUNT=y
CONFIG_PREEMPT_TRACER=y
CONFIG_SCHED_DEBUG=y
CONFIG_DEBUG_KMEMLEAK=y
CONFIG_DEBUG_KMEMLEAK_EARLY_LOG_SIZE=400
CONFIG_DEBUG_KMEMLEAK_DEFAULT_OFF=y
CONFIG_DEBUG_SPINLOCK=y
CONFIG_DEBUG_MUTEXES=y
CONFIG_DEBUG_ATOMIC_SLEEP=y
CONFIG_DEBUG_STACK_USAGE=y
CONFIG_DEBUG_LIST=y
CONFIG_FAULT_INJECTION_DEBUG_FS=y
CONFIG_LOCKUP_DETECTOR=y
CONFIG_DEBUG_PAGEALLOC=y
CONFIG_PAGE_POISONING=y
CONFIG_SLUB_DEBUG=y</pre>

<p>
<strong>2 调试CPU命令</strong>
</p>
<pre class="code">1: 将系统调成performance模式
adb root
adb wait-for-devices
adb root
adb wait-for-devices
sleep 4
adb shell stop MPDecision
adb shell stop thermal-engine  //关闭温控
adb shell stop thermald
adb shell echo 1 &gt; /sys/devices/system/cpu/cpu1/online
adb shell echo 1 &gt; /sys/devices/system/cpu/cpu2/online
adb shell echo 1 &gt; /sys/devices/system/cpu/cpu3/online
sleep 1
adb shell echo performance &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
adb shell echo performance &gt; /sys/devices/system/cpu/cpu1/cpufreq/scaling_governor
adb shell echo performance &gt; /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor
adb shell echo performance &gt; /sys/devices/system/cpu/cpu3/cpufreq/scaling_governor
adb shell sleep 1
adb shell mount -t debugfs none /d
adb shell echo 1 &gt; /sys/kernel/debug/msm-bus-dbg/shell-client/mas
adb shell echo 512 &gt; /sys/kernel/debug/msm-bus-dbg/shell-client/slv
adb shell echo 0 &gt; /sys/kernel/debug/msm-bus-dbg/shell-client/ab
adb shell echo 14928000000 &gt; /sys/kernel/debug/msm-bus-dbg/shell-client/ib 
adb shell echo 1 &gt; /sys/kernel/debug/msm-bus-dbg/shell-client/update_request
sleep 1
adb shell echo none &gt; /sys/class/kgsl/kgsl-3d0/pwrscale/policy
adb shell echo 550000000 &gt; /sys/class/kgsl/kgsl-3d0/gpuclk
adb shell echo performance &gt;/sys/class/devfreq/qcom,cpubw.40/governor
2: 禁止thread migration
adb shell echo 0 &gt; /dev/cpuctl/apps/cpu.notify_on_migrate
3: 通过ADB命令来改变DDR的Clock的频率
adb shell echo active clk2 0 1 max &lt;frequency in KHz&gt; &gt; /d/rpm_send_msg/message
4: 将DDR调成performance模式
adb shell echo none &gt; /sys/class/kgsl/kgsl-3d0/pwrscale/policy
adb shell echo 600000000 &gt; /sys/class/kgsl/kgsl-3d0/gpuclk
adb shell echo performance &gt; /sys/class/kgsl/kgsl-3d0/devfreq/governor
adb shell echo performance &gt;/sys/class/devfreq/qcom,cpubw.26/governor
5: Enable perflock logging
adb pull /system/build.prop
在build.prop加上debug.trace.perf=1
adb push build.prop /system/
adb shell chmod 0644 /system/build.prop
adb shell sync
adb shell reboot
然后在logcat中去grep&quot;PERF&quot;关键字
6: Disable kernel thermal
echo 0 &gt; /sys/module/msm_thermal/core_control/enabled</pre>

<p>
<strong>3 小米手机中高性能模式以及均衡模式实现</strong>
</p>
<pre class="code">高性能可以安兔兔跑分，可以充分发挥cpu的性能
&quot;LEO &quot;* | &quot;MI 4&quot;* | &quot;MI NOTE&quot;* | &quot;VIRGO&quot;*)
case &quot;$powermode&quot; in
&quot;high&quot;)
    stop mpdecision
    sleep 1
    echo 1                                    &gt; /sys/devices/system/cpu/cpu1/online
    echo 1                                    &gt; /sys/devices/system/cpu/cpu2/online
    echo 1                                    &gt; /sys/devices/system/cpu/cpu3/online
    echo 1                                    &gt; /sys/devices/system/cpu/cpu1/online
    echo 1                                    &gt; /sys/devices/system/cpu/cpu2/online
    echo 1                                    &gt; /sys/devices/system/cpu/cpu3/online
    echo 2457600                              &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
    echo 2457600                              &gt; /sys/devices/system/cpu/cpu1/cpufreq/scaling_max_freq
    echo 2457600                              &gt; /sys/devices/system/cpu/cpu2/cpufreq/scaling_max_freq
    echo 2457600                              &gt; /sys/devices/system/cpu/cpu3/cpufreq/scaling_max_freq
    echo performance                          &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    echo performance                          &gt; /sys/devices/system/cpu/cpu1/cpufreq/scaling_governor
    echo performance                          &gt; /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor
    echo performance                          &gt; /sys/devices/system/cpu/cpu3/cpufreq/scaling_governor
    echo 20                                   &gt; /sys/module/cpu_boost/parameters/boost_ms
    echo 1728000                              &gt; /sys/module/cpu_boost/parameters/sync_threshold
    echo 1497600                              &gt; /sys/module/cpu_boost/parameters/input_boost_freq
    echo 40                                   &gt; /sys/module/cpu_boost/parameters/input_boost_ms
    echo 255                                  &gt; /sys/class/leds/lcd-backlight/max_brightness
    echo 578000000                            &gt; /sys/class/kgsl/kgsl-3d0/max_gpuclk
    echo performance                          &gt; /sys/class/kgsl/kgsl-3d0/devfreq/governor
    echo &quot;msm_cpufreq&quot;                        &gt; $dev_governor
   ;;
均衡模式
&quot;middle&quot;)
    echo interactive                          &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    echo interactive                          &gt; /sys/devices/system/cpu/cpu1/cpufreq/scaling_governor
    echo interactive                          &gt; /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor
    echo interactive                          &gt; /sys/devices/system/cpu/cpu3/cpufreq/scaling_governor
    echo 2457600                              &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
    echo 2457600                              &gt; /sys/devices/system/cpu/cpu1/cpufreq/scaling_max_freq
    echo 2457600                              &gt; /sys/devices/system/cpu/cpu2/cpufreq/scaling_max_freq
    echo 2457600                              &gt; /sys/devices/system/cpu/cpu3/cpufreq/scaling_max_freq
    echo &quot;20000 1400000:40000 1700000:20000&quot;  &gt; /sys/devices/system/cpu/cpufreq/interactive/above_hispeed_delay
    echo 90                                   &gt; /sys/devices/system/cpu/cpufreq/interactive/go_hispeed_load
    echo 1190400                              &gt; /sys/devices/system/cpu/cpufreq/interactive/hispeed_freq
    echo &quot;85 1500000:99&quot;                      &gt; /sys/devices/system/cpu/cpufreq/interactive/target_loads
    echo 40000                                &gt; /sys/devices/system/cpu/cpufreq/interactive/min_sample_time
    echo 20                                   &gt; /sys/module/cpu_boost/parameters/boost_ms
    echo 1497600                              &gt; /sys/module/cpu_boost/parameters/sync_threshold
    echo 1190400                              &gt; /sys/module/cpu_boost/parameters/input_boost_freq
    echo 40                                   &gt; /sys/module/cpu_boost/parameters/input_boost_ms
    echo 255                                  &gt; /sys/class/leds/lcd-backlight/max_brightness
    echo 578000000                            &gt; /sys/class/kgsl/kgsl-3d0/max_gpuclk
    echo msm-adreno-tz                        &gt; /sys/class/kgsl/kgsl-3d0/devfreq/governor
    echo &quot;cpubw_hwmon&quot;                        &gt; $dev_governor
    start mpdecision
    ;; </pre>
