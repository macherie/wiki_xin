
<h2 class="sectionedit1" id="高通平台">高通平台:</h2>
<div class="level2">

<p>
固定帧率
</p>
<pre class="code">vi hardware/qcom/camera/QCamera2/HAL/QCamera2HWICallbacks.cpp +2155
adb shell setprop persist.debug.sf.showfps 1
adb logcat | grep Frames
(min_fps)

qiancheng@BU5-SERVER04:~/2.1_msm8939_q39_s201/hardware/qcom/camera$ git diff .
diff --git a/QCamera2/HAL/QCameraParameters.cpp b/QCamera2/HAL/QCameraParameters.cpp
index 61d38f7..92a09da 100644
--- a/QCamera2/HAL/QCameraParameters.cpp
+++ b/QCamera2/HAL/QCameraParameters.cpp
@@ -1923,8 +1923,8 @@ bool QCameraParameters::UpdateHFRFrameRate(const QCameraParameters&amp; params)
                 max_fps = 0;
                 break;
         }
-        m_hfrFpsRange.video_min_fps = (float)min_fps;
-        m_hfrFpsRange.video_max_fps = (float)max_fps;
+        m_hfrFpsRange.video_min_fps = 60000.0;//(float)min_fps;
+        m_hfrFpsRange.video_max_fps = 60000.0;//(float)max_fps;

setprop persist.debug.set.fixedfps 28 (preview fps)
echo -n &#039;file xx.c +p&#039; &gt; /sys/kernel/debug/dynamic_debug/control</pre>

<p>
具体文件hardware/qcom/camera/QCamera2/HAL/QCameraParameters.cpp，代码如下：
</p>
<pre class="code c"><span class="coMULTI">/*===========================================================================
 * FUNCTION   : setPreviewFpsRanges
 *
 * DESCRIPTION: set preview FPS ranges
 *
 * PARAMETERS :
 *   @minFPS  : min FPS value
 *   @maxFPS  : max FPS value
 *
 * RETURN     : int32_t type of status
 *              NO_ERROR  -- success
 *              none-zero failure code
 *==========================================================================*/</span>
<span class="kw4">int32_t</span> QCameraParameters<span class="sy0">::</span><span class="me2">setPreviewFpsRange</span><span class="br0">&#40;</span><span class="kw4">int</span> min_fps<span class="sy0">,</span>
        <span class="kw4">int</span> max_fps<span class="sy0">,</span> <span class="kw4">int</span> vid_min_fps<span class="sy0">,</span><span class="kw4">int</span> vid_max_fps<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="kw4">char</span> str<span class="br0">&#91;</span><span class="nu0">32</span><span class="br0">&#93;</span><span class="sy0">;</span>
    <span class="kw4">char</span> value<span class="br0">&#91;</span>PROPERTY_VALUE_MAX<span class="br0">&#93;</span><span class="sy0">;</span>
    <span class="kw4">int</span> fixedFpsValue<span class="sy0">;</span>
    <span class="coMULTI">/*This property get value should be the fps that user needs*/</span>
    property_get<span class="br0">&#40;</span><span class="st0">&quot;persist.debug.set.fixedfps&quot;</span><span class="sy0">,</span> value<span class="sy0">,</span> <span class="st0">&quot;0&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    fixedFpsValue <span class="sy0">=</span> <a href="http://www.opengroup.org/onlinepubs/009695399/functions/atoi.html"><span class="kw3">atoi</span></a><span class="br0">&#40;</span>value<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
注意：修改帧率需要小于默认帧率，否则会出现丢帧现象。这种方式修改会重启有效，除非重新烧写版本。
</p>

<p>
«««««««««««««««««««««««««««««««««««««««««««««««
</p>

<p>
打开默认的小波降噪
QCamera2/HAL/QCameraParameters.cpp
</p>
<pre class="code">	int32_t QCameraParameters::setWaveletDenoise(const QCameraParameters&amp; params)	3939
	3940	{	{	3940
	3941	    const char *str = params.get(KEY_QC_DENOISE);	    const char *str = params.get(KEY_QC_DENOISE);	3941
	3942	    const char *prev_str = get(KEY_QC_DENOISE);	    const char *prev_str = get(KEY_QC_DENOISE);	3942
	3943	    if (str != NULL) {	    if (str != NULL) {	3943
	3944	        if (prev_str == NULL ||	        if (prev_str == NULL ||	3944
	3945	            strcmp(str, prev_str) != 0) {	            strcmp(str, prev_str) != 0) {	3945
M	3946	            return setWaveletDenoise(str);	            //return setWaveletDenoise(str);	3946
	3947	        }	        }	3947
	3948	    }	    }	3948
M	3949	    return NO_ERROR;	    return setWaveletDenoise(DENOISE_ON);//return NO_ERROR;	3949
	3950	}	}
</pre>
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
<blockquote><div class="no">
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>

<p>
««««««««««««««««««««««««««&lt;
</p>

</div>
<!-- EDIT1 SECTION "高通平台:" [3-3113] -->
<h2 class="sectionedit2" id="mtk平台">MTK平台:</h2>
<div class="level2">

<p>
固定帧率
</p>

<p>
看录像帧率
</p>
<pre class="code">adb shell setprop service.adb.root 1 
adb shell setprop persist.debug.sf.showfps 1
adb logcat | grep Frames</pre>

</div>
<!-- EDIT2 SECTION "MTK平台:" [3114-] -->