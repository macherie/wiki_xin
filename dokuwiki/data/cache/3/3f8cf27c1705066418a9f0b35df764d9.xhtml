
<h1 class="sectionedit1" id="如何开关硬件编解码">如何开关硬件编解码</h1>
<div class="level1">

<p>
高通默认为使用硬件编解码。而且不能动态切换，也就是一个镜像对应某一种编码要么使用硬件要么使用软件编解码。
</p>

</div>
<!-- EDIT1 SECTION "如何开关硬件编解码" [1-201] -->
<h2 class="sectionedit2" id="硬件编解码配置文件">1：硬件编解码配置文件</h2>
<div class="level2">
<pre class="code">  device/qcom/msm8226/media/media_codecs_8226.xml
  device/qcom/msm8226/media/media_profiles_8226.xml</pre>

<p>
如过要禁用某个profile的硬件编码可以这这个文件里把他注释掉。
</p>

</div>
<!-- EDIT2 SECTION "1：硬件编解码配置文件" [202-441] -->
<h2 class="sectionedit3" id="通过frameworks中的flag配置">2：通过frameworks中的flag配置</h2>
<div class="level2">
<pre class="code">  frameworks/av/include/media/stagefright/OMXCodec.h
  frameworks/av/media/libstagefright/OMXCodec.cpp
  </pre>
<pre class="code c"><span class="kw2">enum</span> CreationFlags
<span class="br0">&#123;</span>
    kPreferSoftwareCodecs    <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">,</span>
    kIgnoreCodecSpecificData <span class="sy0">=</span> <span class="nu0">2</span><span class="sy0">,</span>
&nbsp;
    <span class="co1">// The client wants to access the output buffer's video</span>
    <span class="co1">// data for example for thumbnail extraction.</span>
    kClientNeedsFramebuffer  <span class="sy0">=</span> <span class="nu0">4</span><span class="sy0">,</span>
&nbsp;
    <span class="co1">// Request for software or hardware codecs. If request</span>
    <span class="co1">// can not be fullfilled, Create() returns NULL.</span>
    kSoftwareCodecsOnly      <span class="sy0">=</span> <span class="nu0">8</span><span class="sy0">,</span>
    kHardwareCodecsOnly      <span class="sy0">=</span> <span class="nu0">16</span><span class="sy0">,</span> 
&nbsp;
    <span class="co1">// Store meta data in video buffers</span>
    kStoreMetaDataInVideoBuffers <span class="sy0">=</span> <span class="nu0">32</span><span class="sy0">,</span> 
&nbsp;
    <span class="co1">// Only submit one input buffer at one time.</span>
    kOnlySubmitOneInputBufferAtOneTime <span class="sy0">=</span> <span class="nu0">64</span><span class="sy0">,</span> 
&nbsp;
    <span class="co1">// Enable GRALLOC_USAGE_PROTECTED for output buffers from native window</span>
    kEnableGrallocUsageProtected <span class="sy0">=</span> <span class="nu0">128</span><span class="sy0">,</span>
&nbsp;
    <span class="co1">// Secure decoding mode</span>
    kUseSecureInputBuffers <span class="sy0">=</span> <span class="nu0">256</span><span class="sy0">,</span>
<span class="br0">&#125;</span><span class="sy0">;</span></pre>

<p>
使用上面的 flag 在 OMXCodec Create 中指定就可以
</p>

</div>
<!-- EDIT3 SECTION "2：通过frameworks中的flag配置" [442-] -->