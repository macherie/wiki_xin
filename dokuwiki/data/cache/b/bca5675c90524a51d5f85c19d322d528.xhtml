<pre class="code">               ====== How to enable Dolby DS1 on 8926 Bagheera family ======</pre>

<h2 class="sectionedit1" id="get_dolby_license_from_dolby">1. Get dolby license from Dolby</h2>
<div class="level2">

<p>
Ask customer to get dolby license from Dolby.
</p>

</div>
<!-- EDIT1 SECTION "1. Get dolby license from Dolby" [80-171] -->
<h2 class="sectionedit2" id="set_license_metainfo">2. Set license metainfo</h2>
<div class="level2">

<p>
Provide dolby license and dsp.elf file to Qualcomm,they will attach dolby license(vestel_eval_dapv1_ddp_rsa.lic) to dsp.elf and provide us dsp2.mbn and /firmware/ folder.
</p>

</div>
<!-- EDIT2 SECTION "2. Set license metainfo" [172-380] -->
<h3 class="sectionedit3" id="afor_testing_purpose_you_can_use_below_command_to_update_your_adsp_image">a.For testing purpose, you can use below command to update your ADSP image:</h3>
<div class="level3">

<p>
adb root
</p>

<p>
adb remount
</p>

<p>
adb shell mount -o remount,rw /firmware
</p>

<p>
adb push &lt;file&gt; /firmware/image/
</p>

<p>
adb shell sync
</p>

<p>
adb reboot
</p>

</div>
<!-- EDIT3 SECTION "a.For testing purpose, you can use below command to update your ADSP image:" [381-594] -->
<h3 class="sectionedit4" id="bfor_compiling_usage_you_can_copy_and_replace_the_dsp2mbn_to_the_corresponding_folder_to_generate_none-hlosmbn">b.For compiling usage,you can copy and replace the dsp2.mbn to the corresponding folder to generate None-HLOS.mbn.</h3>
<div class="level3">

<p>
~/s55_1028$ find . -name “dsp2.mbn”
</p>

<p>
./Non-HLOS/adsp_proc/obj/qdsp6v5_ReleaseG/non_reloc/dsp2.mbn
</p>

<p>
./Non-HLOS/adsp_proc/obj/qdsp6v5_ReleaseG/dsp2.mbn
</p>

<p>
./Non-HLOS/adsp_proc/build/ms/bin/AAAAAAAA/dsp2.mbn
</p>

<p>
./Non-HLOS/adsp_proc/build/ms/bin/AAAAAAAA/non-reloc/dsp2.mbn
</p>

<p>
cd Non-HLOS/common/build
</p>

<p>
source S55.sh(update_common_info.py –nonhlos)
</p>

<p>
Non-HLOS/common/build/bin/asic/NON-HLOS.bin
</p>

</div>
<!-- EDIT4 SECTION "b.For compiling usage,you can copy and replace the dsp2.mbn to the corresponding folder to generate None-HLOS.mbn." [595-1107] -->
<h2 class="sectionedit5" id="modify_the_systemprop">3. Modify the system.prop</h2>
<div class="level2">

</div>
<!-- EDIT5 SECTION "3. Modify the system.prop" [1108-1147] -->
<h3 class="sectionedit6" id="do_following_steps_before_starting_dap_testing_on_8916">Do following steps before starting DAP testing on 8916:</h3>
<div class="level3">

<p>
Modify .\device\qcom\&lt;platform&gt;\system.prop, adding
</p>

<p>
dmid=&lt;dmid&gt;
</p>

<p>
audio.ds1.metainfo.key=273
</p>

</div>
<!-- EDIT6 SECTION "Do following steps before starting DAP testing on 8916:" [1148-1310] -->
<h3 class="sectionedit7" id="for_fast_verification_purpose_you_can">For fast verification purpose, you can</h3>
<div class="level3">

<p>
adb root
</p>

<p>
adb remount
</p>

<p>
adb shell “echo &#039;dmid=&lt;dmid&gt;&#039; » /system/build.prop”
</p>

<p>
adb shell “echo &#039;audio.ds1.metainfo.key=273&#039; » /system/build.prop”
</p>

<p>
adb reboot
</p>

<p>
<strong>Default key(audio.ds1.metainfo.key)</strong> used for dolby is 273
</p>

<p>
<strong>&lt;dmid&gt;</strong> is a serial digital number which should be got from dolby as well
</p>

<p>
Dolby provide to the Manufacturer ID (DMID) version:
</p>

<p>
Decimal: 247639057(use Decimal)
</p>

<p>
Hex: 0x0ec2ac11
</p>

</div>
<!-- EDIT7 SECTION "For fast verification purpose, you can" [1311-1766] -->
<h2 class="sectionedit8" id="enable_ac3_ec3_file">4.Enable .ac3(.ec3)file</h2>
<div class="level2">

<p>
diff –git a/media_codecs.xml b/media_codecs_8226.xml
</p>

<p>
— a/media_codecs.xml
</p>

<p>
+++ b/media_codecs_8226.xml
@@ -84,6 +84,16 @@
</p>
<pre class="code">       &lt;MediaCodec name=&quot;OMX.qcom.audio.decoder.evrc&quot; type=&quot;audio/evrc&quot; &gt;
           &lt;Quirk name=&quot;requires-global-flush&quot; /&gt;
       &lt;/MediaCodec&gt;
       </pre>

<p>
add start—
</p>
<pre class="code">       
      &lt;!-- DOLBY_UDC --&gt;
      &lt;MediaCodec name=&quot;OMX.dolby.ac3.decoder&quot; type=&quot;audio/ac3&quot; &gt;
          &lt;Quirk name=&quot;needs-flush-before-disable&quot; /&gt;
          &lt;Quirk name=&quot;requires-flush-complete-emulation&quot; /&gt;
      &lt;/MediaCodec&gt;
      &lt;MediaCodec name=&quot;OMX.dolby.ec3.decoder&quot; type=&quot;audio/eac3&quot; &gt;
          &lt;Quirk name=&quot;needs-flush-before-disable&quot; /&gt;
          &lt;Quirk name=&quot;requires-flush-complete-emulation&quot; /&gt;
      &lt;/MediaCodec&gt;
      &lt;!-- DOLBY_UDC END --&gt;
      </pre>

<p>
add end—
</p>
<pre class="code">       &lt;!-- Video Hardware  --&gt;
       &lt;MediaCodec name=&quot;OMX.qcom.video.decoder.avc&quot; type=&quot;video/avc&quot; &gt;
           &lt;Quirk name=&quot;requires-allocate-on-input-ports&quot; /&gt;
      </pre>

</div>
<!-- EDIT8 SECTION "4.Enable .ac3(.ec3)file" [1767-2800] -->
<h2 class="sectionedit9" id="select_audio_ds1_topology_in_acdb">5.Select AUDIO_DS1_TOPOLOGY in ACDB.</h2>
<div class="level2">

<p>
View –&gt; Device Designer –&gt; SPKR_PHONE_SPKR_MONO–&gt;Audio PoPP Topology –&gt; GENERAL_PLAYBACK = AUDIO_DS1_TOPOLOGY
</p>

<p>
View –&gt; Device Designer –&gt; HEADSET_SPKR_STEREO–&gt;Audio PoPP Topology –&gt; GENERAL_PLAYBACK = AUDIO_DS1_TOPOLOGY
</p>

</div>
<!-- EDIT9 SECTION "5.Select AUDIO_DS1_TOPOLOGY in ACDB." [2801-3080] -->
<h2 class="sectionedit10" id="disable_audio_function">6. Disable audio+ function</h2>
<div class="level2">

<p>
To disable audio+ function,you need reset POPP as AUDIO_Stream_Default in QACT device design as below:
</p>

<p>
View –&gt; Device Designer –&gt; Audio PoPP Topology –&gt; GENERAL_PLAYBACK = AUDIO_Stream_Default
</p>

</div>
<!-- EDIT10 SECTION "6. Disable audio+ function" [3081-3318] -->
<h2 class="sectionedit11" id="test_the_dolby_function">7. Test the dolby function</h2>
<div class="level2">

<p>
Push a song of .ac3(.ec3) file into the phone.
</p>

<p>
If you can play the song normal,then congratulations!  <img src="/dokuwiki/lib/images/smileys/icon_razz.gif" class="icon" alt=":-P" />
You have added the Dolby function.
</p>

<p>
<abbr title="By the way">BTW</abbr>,if there&#039;s a little staccato or some jump when you play the music or mp3 music,maybe the license is an evaluated version.
Ask Dolby for a formal version license.
</p>

</div>
<!-- EDIT11 SECTION "7. Test the dolby function" [3319-] -->