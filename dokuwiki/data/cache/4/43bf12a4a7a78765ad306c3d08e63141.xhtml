
<h1 class="sectionedit1" id="audio_ftm_test">Audio ftm test</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "Audio ftm test" [1-30] -->
<h2 class="sectionedit2" id="get_the_configuration_file">Get the configuration file:</h2>
<div class="level2">

<p>
To run the FTM test, it needs the configuration file, the configuration is put in the Linux Android AP source code side.
</p>

<p>
The location is at
</p>

<p>
“./vendor/qcom/proprietary/mm-audio/audio_ftm/config/8&times;26/ftm_test_config” for 8&times;26
</p>

<p>
“./vendor/qcom/proprietary/mm-audio/audio_ftm/config/8&times;10/ftm_test_config” for 8&times;10
</p>

<p>
If you can&#039;t find it, please sync the latest source code.
</p>

</div>
<!-- EDIT2 SECTION "Get the configuration file:" [31-443] -->
<h2 class="sectionedit3" id="understanding_the_configuration_file">Understanding the configuration file:</h2>
<div class="level2">

<p>
Following are keywords which be parsed by the test app from config file when a test case is executed:
</p>
<pre class="code">  tc --&gt;Keyword to indicate beginning of a test case
  
  ! --&gt;prefix character indicating test case type, following are supported strings that should be appended:
  
      Capture
      
      Playback
      
      FM
      
      CodecLoop
      
      AfeLoop
      
  # --&gt;prefix character for indicating that string appened to it is a comment.
  
  enable --&gt;keyword to indicate mixer command sequence for starting test case
  
  disable --&gt;keyword to indicate mixer command sequence for stopping test case
  
  Rxdevice --&gt;Keyword to indicate the pcm playback device id.
  
  Txdevice --&gt;Keyword to indicate the pcm capture device id.
  
  </pre>

<p>
Keyword highlighted in red are mandatory items when a new test case is added.
</p>

<p>
It is also mandatory to maintain the sequence of keywords as per following figure when new test case is added.
</p>

<p>
Here is an example of one test case.
</p>

<p>
—
</p>

<p>
tc 1 –&gt;test case number
</p>

<p>
#Handset Capture –&gt;Comments as test case title
</p>

<p>
!Capture –&gt;test case type
</p>

<p>
Txdevice:0 –&gt;the sound device under test
</p>

<p>
enable –&gt;followed by this is the amix command sequence to start the test case
</p>

<p>
SLIM_0_TX Channels:One
</p>

<p>
AIF1_CAP Mixer SLIM TX1:1
</p>

<p>
MultiMedia1 Mixer SLIM_0_TX:1
</p>

<p>
SLIM TX1 MUX:DEC1
</p>

<p>
DEC1 MUX:ADC1
</p>

<p>
ADC1 Volume:50
</p>

<p>
DEC1 Volume:50
</p>

<p>
disable –&gt;followed by this is the amix command sequence to stop the test
</p>

<p>
AIF1_CAP Mixer SLIM TX1:0
</p>

<p>
MultiMedia1 Mixer SLIM_0_TX:0
</p>

<p>
SLIM TX1 MUX:ZERO
</p>

<p>
DEC1 MUX:ZERO
</p>

<p>
ADC1 Volume:0
</p>

<p>
DEC1 Volume:0
</p>

<p>
Customer can modify the config file to customize the FTM test cases by following the configuration syntax.
</p>

</div>
<!-- EDIT3 SECTION "Understanding the configuration file:" [444-2211] -->
<h2 class="sectionedit4" id="enter_the_following_command_sequences_for_preparation">Enter the following command sequences for preparation :</h2>
<div class="level2">

<p>
adb root
</p>

<p>
adb remount
</p>

<p>
adb push ftm_test_config /data/
</p>

<p>
adb shell
</p>

<p>
It will put the configuration file in device folder /data/
</p>

</div>
<!-- EDIT4 SECTION "Enter the following command sequences for preparation :" [2212-2410] -->
<h2 class="sectionedit5" id="command_and_parameters_to_run_the_test_case">Command and parameters to run the test case:</h2>
<div class="level2">

<p>
Wave File playback :
</p>
<pre class="code">  /system/bin/mm-audio-ftm -tc &lt;Test_case_number&gt; -c &lt;path to config file&gt; -d &lt;Duration&gt; -v   &lt;Volume&gt; -file &lt;Path_to_wav&gt;
  </pre>

<p>
Tone playback:
</p>
<pre class="code">  /system/bin/mm-audio-ftm -tc &lt;Test_case_number&gt; -c &lt;path to config file&gt; -d &lt;Duration&gt; -v   &lt;Volume&gt; -fl &lt;frequency_low&gt; -fh &lt;frequency_high&gt;
  </pre>

<p>
Audio Capture :
</p>
<pre class="code">  /system/bin/mm-audio-ftm -tc &lt;Test_case_number&gt; -c &lt;path to config file&gt; -d &lt;Duration&gt;
  </pre>

<p>
FM :
</p>
<pre class="code">  /system/bin/mm-audio-ftm -tc &lt;Test_case_number&gt; -c &lt;path to config file&gt;
  </pre>

<p>
AFE/ADIE loop back :
</p>
<pre class="code">  /system/bin/mm-audio-ftm -tc &lt;Test_case_number&gt; -c &lt;path to config file&gt; -d &lt;Duration&gt; -v &lt;Volume&gt;
  </pre>

</div>
<!-- EDIT5 SECTION "Command and parameters to run the test case:" [2411-3119] -->
<h2 class="sectionedit6" id="the_following_examples_are_verified_on_8x26">The following examples are verified on 8x26:</h2>
<div class="level2">

<p>
AFE loopback (Handset MIC → Earpiece)
</p>

<p>
#/system/bin/mm-audio-ftm -tc 27 -c /data/ftm_test_config -d 60 -v 67
</p>

<p>
Codec loopback (Handset MIC → Earpiece)
</p>

<p>
#/system/bin/mm-audio-ftm -tc 33 -c /data/ftm_test_config -d 60 -v 67
</p>

<p>
Playback (#Ear Piece)
</p>

<p>
/system/bin/mm-audio-ftm -tc 2 -c /data/ftm_test_config -d 20 -v 70 -file /data/test.wav
</p>

<p>
Recording (#Handset Capture)
</p>

<p>
/system/bin/mm-audio-ftm -tc 1 -c /data/ftm_test_config -d 10
</p>

<p>
The recorded file is saved as /data/ftm_pcm_record.wav
</p>

</div>
<!-- EDIT6 SECTION "The following examples are verified on 8x26:" [3120-3668] -->
<h2 class="sectionedit7" id="the_following_examples_are_verified_on_8939">The following examples are verified on 8939:</h2>
<div class="level2">

<p>
mm-audio-ftm -tc 15 -c /data/ftm_test_config -d 30 -v 75(Q39 耳机回环）
</p>

<p>
mm-audio-ftm -tc 18 -c /data/ftm_test_config -d 30 -v 75（Q39回环 耳机说，speaker放）
</p>

<p>
Playback (#Ear Piece)
</p>

<p>
/system/bin/mm-audio-ftm -tc 2 -c /data/ftm_test_config -d 20 -v 70 -file /data/test.wav
</p>

<p>
Recording (#Handset Capture)
</p>

<p>
/system/bin/mm-audio-ftm -tc 1 -c /data/ftm_test_config -d 10
</p>

<p>
The recorded file is saved as /data/ftm_pcm_record.wav
</p>

</div>
<!-- EDIT7 SECTION "The following examples are verified on 8939:" [3669-] -->