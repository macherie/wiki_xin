
<p>
默认debugfs位置
cd /mnt/debugfs
</p>

<p>
<strong>Linux debugfs使用分享</strong>
</p>

<p>
软件查看gpio状态
</p>

<p>
在调试中加入debugfs有时可以起到事半功倍的效果： 
</p>
<pre class="code">adb shell
 #mkdir /data/debug
 #mount -t debugfs debugfs /data/debug
 #cd /data/debug </pre>

<p>
查看gpio状态
</p>

<p>
root@Android:/data/debugfs # cat gpio
</p>

<p>
GPIOs 0-15:
</p>
<pre class="code">gpio-0  (front_camera_rst    ) out lo</pre>

<p>
GPIOs 16-42:
</p>
<pre class="code">gpio-17  (tsl2771_int        ) in  hi
gpio-26  (ctp_reset          ) out hi
gpio-29  (front_camera_pwd    ) out hi
gpio-31  (gpio_kp_out        ) out lo
gpio-32  (gpio_kp_out        ) out lo
gpio-35  (GPIO_E186_POWER    ) in  lo
gpio-36  (gpio_kp_in          ) in  hi
gpio-37  (gpio_kp_in          ) in  hi
gpio-42  (hs_sw              ) in  hi</pre>

<p>
GPIOs 43-67:
</p>
<pre class="code">gpio-48  (ctp_irq            ) in  hi
gpio-60  (qup_scl            ) in  hi
gpio-61  (qup_sda            ) in  hi</pre>

<p>
GPIOs 68-94:
</p>
<pre class="code">gpio-76  (lis3dh_acc_int      ) in  lo
gpio-82  ([auto]              ) out hi
gpio-85  (bahama sys_rst_n    ) in  lo
gpio-94  ([auto]              ) out hi</pre>

<p>
GPIOs 95-106:
</p>
<pre class="code">gpio-97  (MDP_VSYNC          ) in  lo</pre>

<p>
GPIOs 107-132:
</p>
<pre class="code">gpio-107 (ctp_power          ) in  hi
gpio-115 (GPIO_E186_WAKEUP    ) in  lo
gpio-131 (qup_scl            ) in  hi
gpio-132 (qup_sda            ) in  hi</pre>

<p>
查看regulator
</p>

<p>
 root@android:/data/debugfs # cd regulator/  
</p>
<pre class="code">dummy/ ldo03/ ldo06/ ldo09/ ldo12/ ldo15/ ldo18/ smps1/ smps4/
ldo01/ ldo04/ ldo07/ ldo10/ ldo13/ ldo16/ ldo19/ smps2/
ldo02/ ldo05/ ldo08/ ldo11/ ldo14/ ldo17/ ncp/  smps3/
 </pre>

<p>
root@android:/data/debugfs # cat regulator/ldo10/voltage
</p>
<pre class="code">3000000
 </pre>

<p>
查看clk
</p>

<p>
 root@android:/ # cat /data/debugfs/clk/ 
</p>
<pre class="code">adm_clk/                  ebi_mddi_clk/
 sdc1_p_clk/         
adsp_clk/                ebi_vfe_clk/
 sdc2_clk/           
ahb_m_clk/                ecodec_clk/
 sdc2_p_clk/         
ahb_s_clk/                gp_clk/
 sdc3_clk/           
cam_m_clk/                grp_3d_clk/
 sdc3_p_clk/         
csi0_clk/                grp_3d_p_clk/
 sdc4_clk/           
csi0_p_clk/              gsbi1_qup_clk/
 sdc4_p_clk/         
csi0_vfe_clk/            gsbi1_qup_p_clk/
 tsif_p_clk/         
csi1_clk/                gsbi2_qup_clk/
 tsif_ref_clk/       
csi1_p_clk/              gsbi2_qup_p_clk/
 uart1_clk/           
csi1_vfe_clk/            icodec_rx_clk/
 uart1dm_clk/         
debug_suspend            icodec_tx_clk/
 uart2_clk/           
dsi_byte_clk/            imem_clk/
 uart2dm_clk/         
dsi_clk/                  mdp_clk/
 usb_hs2_clk/         
dsi_esc_clk/              mdp_dsi_p_clk/
 usb_hs_clk/         
dsi_pixel_clk/            mdp_lcdc_pad_pclk_clk/
 usb_hs_core_clk/     
dsi_ref_clk/              mdp_lcdc_pclk_clk/
 usb_hs_p_clk/       
ebi1_clk/                mdp_vsync_clk/
 usb_phy_clk/         
ebi2_clk/                pbus_clk/
 vdc_clk/             
ebi_acpu_clk/            pcm_clk/
 vfe_clk/             
ebi_adm_clk/              pmdh_clk/
 vfe_mdc_clk/         
ebi_grp_3d_clk/          sdac_clk/               
ebi_lcdc_clk/            sdc1_clk/ </pre>

<p>
查看时钟
</p>

<p>
root@android:/ # cat /data/debugfs/clk/mdp_clk/rate   
</p>
<pre class="code">200000000</pre>

<p>
使用debugfs调试：
</p>
<pre class="code">root@android:/ # mkdir /data/debugfs

root@android:/ # mount -t debugfs debugfs /data/debugfs                       

root@android:/ # cd /data/debugfs/                                             

root@android:/data/debugfs # cd pm8921                                         

pm8921-bms/  pm8921-dbg/  pm8921_chg/  

root@android:/data/debugfs # cd pm8921_chg/                                    

root@android:/data/debugfs/pm8921_chg # 

root@android:/data/debugfs/pm8921_chg # 

root@android:/data/debugfs/pm8921_chg # ls -l

  -r--r--r-- root     root            0 2013-04-18 15:25 ATCDONE_IRQ
  -r--r--r-- root     root            0 2013-04-18 15:25 ATCFAIL_IRQ
  -r--r--r-- root     root            0 2013-04-18 15:25 BATFET_IRQ
  -r--r--r-- root     root            0 2013-04-18 15:25 BATTTEMP_COLD_IRQ
 -r--r--r-- root     root            0 2013-04-18 15:25 ATCDONE_IRQ</pre>

<p>
查看中断状态：
</p>
<pre class="code">root@android:/data/debugfs/pm8921_chg # cat FASTCHG_IRQ    //查看是否在快速充电阶段 调用get_reg（）；

1

dmesg:

&lt;4&gt;[   95.057652] get_rt_status i=14 ret=1 </pre>

<p>
查看寄存器的值：
</p>
<pre class="code">root@android:/data/debugfs/pm8921_chg # cat CHG_ITERM       //查看充电截至电流寄存器Value 调用set_reg（）；

0x07

dmesg:

&lt;4&gt;[  275.319975] get_reg data = 0x215, val= 0x07</pre>

<p>
写入某个寄存器：
</p>
<pre class="code">root@android:/data/debugfs/pm8921_chg # echo 0x06 &gt; CHG_ITERM   //将0x06写入CHG_ITERM   调用get_rt_status（）；

0x07

dmesg:

&lt;4&gt;[  476.374118] set_reg data = 0x215, val= 0x06</pre>

<p>
读写PMIC寄存器，通过高通的spmi通信协议
</p>
<pre class="code">root@s55:/data/debug/spmi/spmi-0 # echo 0x0001 &gt; address

root@s55:/data/debug/spmi/spmi-0 # cat data
01110 -- 00</pre>
